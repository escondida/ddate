MKSHELL = rc
CC = cc

TARGS = ddate slogans

SLOGANS = \
	ddata/slogans/discordian \
	ddata/slogans/miscellaneous \
	ddata/slogans/neologisms \
	@EXTRASLOGANS@

# No -Werror for now.
CFLAGS = \
	-g -ggdb -std=gnu11 \
	-O2 -fPIE -march=native -D_FORTIFY_SOURCE=2 \
	-fstack-protector-strong --param=ssp-buffer-size=1 -flto \
	-fsanitize=undefined -fsanitize-trap=undefined \
	`{pkg-config --cflags glew glfw3 libcurl sqlite3} \
	$CFLAGS \

LDFLAGS = -Wl,-z,relro,-z,now,--build-id -pie \
	`{pkg-config --libs glew glfw3 libcurl sqlite3} \
	$LDFLAGS

all:V: $TARGS

slogans: $SLOGANS
	cat $prereq > $target

ddate:Q: src/ddate.o src/slogans.o src/tibs.o src/util.o
	echo $CC -o $target $prereq
	$CC $CFLAGS $LDFLAGS -o $target $prereq

src/%.o:Q: src/%.c
	echo $CC -c -o $target src/$stem.c
	$CC $CFLAGS -c -o $target src/$stem.c

src/ddate.o: src/ddate.h src/slogans.h
src/slogans.o: src/slogans.h src/util.h
src/tibs.o: src/tibs.h
src/util.o: src/util.h

clean:V:
	rm -f $TARGS src/*.o

nuke:V: clean
	rm -f mkfile
